apiVersion: kubescape.io/v1
kind: Rules
metadata:
  name: unexpected-domain-request-rule
  namespace: kubescape
  labels:
    app: kubescape
spec:
  rules:
    - name: "DNS Anomalies in container"
      enabled: true
      id: "R0005"
      description: "Detecting unexpected domain requests that are not whitelisted by application profile."
      expressions:
        message: "'Unexpected domain communication: ' + event.name + ' from: ' + event.containerName"
        uniqueId: "event.comm + '_' + event.name"
        ruleExpression:
          - eventType: "dns"
            expression: "!event.name.endsWith('.svc.cluster.local.') && !nn.is_domain_in_egress(event.containerId, event.name)"
      profileDependency: 0
      severity: 1
      supportPolicy: false
      isTriggerAlert: false
      mitreTactic: "TA0011"
      mitreTechnique: "T1071.004"
      tags:
        - "dns"
        - "anomaly"
        - "networkprofile"
